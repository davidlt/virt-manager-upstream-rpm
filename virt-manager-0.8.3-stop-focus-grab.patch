# HG changeset patch
# User Cole Robinson <crobinso@redhat.com>
# Date 1266952692 18000
# Node ID 962e52a4b4c0441eb5e9e8aeb1bb17597282579c
# Parent  4e4e674d4921264cfe376ed48dcab10c8d3a3b69
Drop redundant calls to window.show()

diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/about.py
--- a/src/virtManager/about.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/about.py	Tue Feb 23 14:18:12 2010 -0500
@@ -48,7 +48,6 @@
     def show(self):
         dialog = self.window.get_widget("vmm-about")
         dialog.set_version(self.config.get_appversion())
-        dialog.show_all()
         dialog.present()
 
     def close(self,ignore1=None,ignore2=None):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/addhardware.py
--- a/src/virtManager/addhardware.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/addhardware.py	Tue Feb 23 14:18:12 2010 -0500
@@ -166,7 +166,6 @@
 
     def show(self):
         self.reset_state()
-        self.topwin.show()
         self.topwin.present()
 
     def close(self, ignore1=None,ignore2=None):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/clone.py
--- a/src/virtManager/clone.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/clone.py	Tue Feb 23 14:18:12 2010 -0500
@@ -140,7 +140,6 @@
 
     def show(self):
         self.reset_state()
-        self.topwin.show()
         self.topwin.present()
 
     def close(self, ignore1=None, ignore2=None):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/connect.py
--- a/src/virtManager/connect.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/connect.py	Tue Feb 23 14:18:12 2010 -0500
@@ -108,7 +108,6 @@
 
     def show(self):
         win = self.window.get_widget("vmm-open-connection")
-        win.show_all()
         win.present()
         self.reset_state()
 
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/createinterface.py
--- a/src/virtManager/createinterface.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/createinterface.py	Tue Feb 23 14:18:12 2010 -0500
@@ -124,7 +124,6 @@
 
     def show(self):
         self.reset_state()
-        self.topwin.show()
         self.topwin.present()
 
     def show_bond_config(self, src):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/createnet.py
--- a/src/virtManager/createnet.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/createnet.py	Tue Feb 23 14:18:12 2010 -0500
@@ -82,7 +82,6 @@
         self.set_initial_state()
 
     def show(self):
-        self.topwin.show()
         self.reset_state()
         self.topwin.present()
 
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/createpool.py
--- a/src/virtManager/createpool.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/createpool.py	Tue Feb 23 14:18:12 2010 -0500
@@ -115,7 +115,6 @@
         self.set_initial_state()
 
     def show(self):
-        self.topwin.show()
         self.reset_state()
         self.topwin.present()
 
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/createvol.py
--- a/src/virtManager/createvol.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/createvol.py	Tue Feb 23 14:18:12 2010 -0500
@@ -89,7 +89,6 @@
 
     def show(self):
         self.reset_state()
-        self.topwin.show()
         self.topwin.present()
 
     def close(self, ignore1=None, ignore2=None):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/delete.py
--- a/src/virtManager/delete.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/delete.py	Tue Feb 23 14:18:12 2010 -0500
@@ -85,7 +85,6 @@
 
     def show(self):
         self.reset_state()
-        self.topwin.show()
         self.topwin.present()
 
     def close(self, ignore1=None, ignore2=None):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/details.py
--- a/src/virtManager/details.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/details.py	Tue Feb 23 14:18:12 2010 -0500
@@ -302,7 +302,6 @@
         if self.is_visible():
             self.topwin.present()
             return
-        self.topwin.show()
         self.topwin.present()
 
         self.engine.increment_window_counter()
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/domain.py
--- a/src/virtManager/domain.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/domain.py	Tue Feb 23 14:18:12 2010 -0500
@@ -134,7 +134,7 @@
     def set_autostart(self, val):
         raise NotImplementedError()
 
-    def attach_device(self, devobj):
+    def attach_device(self, devobj, devxml=None):
         raise NotImplementedError()
     def detach_device(self, devtype, dev_id_info):
         raise NotImplementedError()
@@ -1314,13 +1314,17 @@
     def get_id(self):
         return self._backend.ID()
 
-    def attach_device(self, devobj):
+    def attach_device(self, devobj, devxml=None):
         """
         Hotplug device to running guest
         """
-        if self.is_active():
-            xml = devobj.get_xml_config()
-            self._backend.attachDevice(xml)
+        if not self.is_active():
+            return
+
+        if not devxml:
+            devxml = devobj.get_xml_config()
+
+        self._backend.attachDevice(devxml)
 
     def detach_device(self, devtype, dev_id_info):
         """
@@ -1591,7 +1595,7 @@
         ignore, diskxml = util.xml_parse_wrapper(self.get_xml(), func,
                                                  dev_id_info, newpath, _type)
 
-        self.attach_device(diskxml)
+        self.attach_device(None, diskxml)
 
     # VCPU changing
     def define_vcpus(self, vcpus):
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/host.py
--- a/src/virtManager/host.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/host.py	Tue Feb 23 14:18:12 2010 -0500
@@ -294,8 +294,10 @@
 
 
     def show(self):
-        dialog = self.window.get_widget("vmm-host")
-        dialog.present()
+        if self.is_visible():
+            self.topwin.present()
+            return
+        self.topwin.present()
 
         self.engine.increment_window_counter()
 
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/manager.py
--- a/src/virtManager/manager.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/manager.py	Tue Feb 23 14:18:12 2010 -0500
@@ -124,6 +124,8 @@
                                   0, gtk.MESSAGE_ERROR, gtk.BUTTONS_CLOSE,
                                   _("Unexpected Error"),
                                   _("An unexpected error occurred"))
+        self.topwin = self.window.get_widget("vmm-manager")
+
         self.config = config
         self.engine = engine
 
@@ -136,8 +138,7 @@
         self.rows = {}
 
         w, h = self.config.get_manager_window_size()
-        self.window.get_widget("vmm-manager").set_default_size(w or 550,
-                                                               h or 550)
+        self.topwin.set_default_size(w or 550, h or 550)
 
         self.init_vmlist()
         self.init_stats()
@@ -221,12 +222,11 @@
     ##################
 
     def show(self):
-        win = self.window.get_widget("vmm-manager")
         if self.is_visible():
-            win.present()
+            self.topwin.present()
             return
-        win.show()
-        win.present()
+        self.topwin.present()
+
         self.engine.increment_window_counter()
 
         if self.startup_error:
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/preferences.py
--- a/src/virtManager/preferences.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/preferences.py	Tue Feb 23 14:18:12 2010 -0500
@@ -37,7 +37,6 @@
         self.config = config
 
         self.topwin = self.window.get_widget("vmm-preferences")
-        self.topwin.hide()
 
         self.config.on_view_system_tray_changed(self.refresh_view_system_tray)
         self.config.on_console_popup_changed(self.refresh_console_popup)
@@ -102,7 +101,6 @@
         return 1
 
     def show(self):
-        self.topwin.show()
         self.topwin.present()
 
     #########################
diff -r 4e4e674d4921 -r 962e52a4b4c0 src/virtManager/storagebrowse.py
--- a/src/virtManager/storagebrowse.py	Tue Feb 23 09:03:13 2010 +0000
+++ b/src/virtManager/storagebrowse.py	Tue Feb 23 14:18:12 2010 -0500
@@ -90,7 +90,6 @@
 
     def show(self, conn=None):
         self.reset_state(conn)
-        self.topwin.show()
         self.topwin.present()
 
     def close(self, ignore1=None, ignore2=None):
